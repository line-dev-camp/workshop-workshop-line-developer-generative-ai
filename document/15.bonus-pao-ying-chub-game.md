# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:2000/format:webp/1*gglam8N3kkByNJ49Qt6xoQ.png"> 
</p>

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ firestore , functions, emulator ‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Firebase Project 
<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDYKMNY_4fqrzTFY_keVxQ.png"> 
</p>



## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå

‡πÇ‡∏à‡∏ó‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏ß‡πà‡∏≤ ‚Ä¶

‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á LINE Official Account ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å ‡πÄ‡∏£‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ LINE Group Only

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s1AXwqT-70761pOnAX8qZg.png"> 
</p>


2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏≤‡∏Å LINE Chatbot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ ‡πÉ‡∏ä‡πâ Quick Reply ‡πÅ‡∏•‡∏∞ Flex Message ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ : ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô Quick Reply ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á Mobile ‡πÅ‡∏•‡∏∞ PC

3. ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kXAvX_rmSkKGN_IkzcZjOg.png"> 
</p>


- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á ‚Äú‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‚Äù ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ ‡∏£‡πà‡∏ß‡∏°‡∏ñ‡∏∂‡∏á ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô ‡∏ä‡∏ô‡∏∞ ‡πÅ‡∏û‡πâ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏™‡∏°‡∏≠
- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏° Quick Reply ‡πÑ‡∏î‡πâ ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ ‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á ‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ ‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÄ‡∏Å‡∏° ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏∞‡∏à‡∏ö ‡∏´‡∏£‡∏∑‡∏≠ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ï‡∏∞ Chatbot ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏° ‡∏Å‡πá‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏Å‡∏°
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ‡πÅ‡∏•‡∏∞ ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Ñ‡πâ‡∏≠‡∏ô ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© ‡∏î‡πâ‡∏ß‡∏¢ Flex Message ‡πÇ‡∏î‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡∏ô‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏Å‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏´‡∏≤‡∏Å‡∏ä‡∏ô‡∏∞ ‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ ‡πÅ‡∏û‡πâ ‡∏à‡∏∞‡πÇ‡∏î‡∏ô‡∏≠‡∏∞‡πÑ‡∏£ ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏ö‡πÄ‡∏Å‡∏°
- ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö‡πÄ‡∏Å‡∏° ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ ‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏°‡∏≠
- ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏ö‡πÄ‡∏Å‡∏° ‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏Å ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‡∏à‡∏ö‡πÄ‡∏Å‡∏°

## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô LINE Event Type(Code File : webhook.js)

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4bN3iOHGX-eb29Pw.png"> 
</p>
<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A2SYMsqFu0oq4eMBZeZSiw.png"> 
</p>

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡∏∞‡∏à‡∏≤‡∏Å‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ Event Type ‡πÅ‡∏•‡∏∞ Source Type ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

Event Source Type Group

```javascript
if (event.source.type !== "group") {
   return res.end();
}
```
‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà LINE Group ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô


2. Event Type : join
<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ws7n5avDP296S13V.png"> 
</p>


```javascript
// Invite LINE Offcial Account : ‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö
// [IMPORTANT] Enable Toggle : Feature Allow account to join groups and multi-person chats
// https://developers.line.biz/en/reference/messaging-api/#join-event
if (event.type === "join") {
    await line.reply(event.replyToken, [messages.textMessageQuickReply("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô ‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö‡∏Å‡∏±‡∏ô‡∏ô‡∏ô \n ‡∏ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏î‡∏π ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤ ‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô ")])
    return res.end();
}
```
‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ LINE Chatbot ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Interactive ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡∏ó‡∏≥‡πÉ‡∏´‡πâ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á Chatbot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡πá‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô

3. Event Type : memberJoined

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*riShxH4XJoyyz2qu.png"> 
</p>

```javascript
// Invite User Player 
// https://developers.line.biz/en/reference/messaging-api/#member-joined-event
if (event.type === "memberJoined") {
    for (let member of event.joined.members) {
        if (member.type === "user") {
            // Check Game Running Status in Group  
            // For Message New Joiner Group 
            const count = await firebase.getCountGameGroupStatus(groupId, false)
            // If Games in the group haven't started yet
            if (count === 0) {
                await line.reply(event.replyToken, [messages.textMessageQuickReply("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà ‡∏Å‡∏î '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÅ‡∏•‡∏∞ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏° ")])
            } else {
                //  Game has begun.
                await line.reply(event.replyToken, [messages.textMessage("‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ")])
            }
        }
    }
    return res.end();
}
```

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ Chatbot ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Interactive ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô ‡∏Å‡πá‡πÄ‡∏•‡∏¢‡πÉ‡∏´‡πâ Chatbot ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£ ‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ

```javascript
const count = await firebase.getCountGameGroupStatus(groupId, false)
```

‡∏ú‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô getCountGameGroupStatus ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ query ‡πÉ‡∏ô firestore ‡∏ñ‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏Å‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Chatbot ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏Å‡∏•‡πà‡∏≤‡∏ß ‚Äú‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà‚Äù
‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏Å‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ Chatbot ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏∂‡∏á ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
‡πÇ‡∏î‡∏¢‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á firestore ‡∏à‡∏∞‡∏Ç‡∏≠‡πÄ‡∏•‡πà‡∏≤‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ step ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÄ‡∏•‡πà‡∏ô ‡πÅ‡∏•‡∏∞ ‡∏à‡∏ö‡πÄ‡∏Å‡∏°

4. Event Type : leave
<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JA_FlUnZnaH1w7V2.png"> 
</p>

```javascript
// https://developers.line.biz/en/reference/messaging-api/#leave-event
if (event.type === "leave") {
    // Delete Game Document when LINE OA Leave Group
    await firebase.deleteGameGroup(groupId)
    return res.end();
}
```
event ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏Ñ‡∏£‡∏™‡∏±‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏ï‡∏∞ Chatbot ‡∏≠‡∏≠‡∏Å ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Database ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠ Chatbot ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏¢‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Database ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡πÄ‡∏ä‡∏¥‡∏á‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î ‡∏´‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏ó‡∏≥ report ‡∏Å‡πá‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏Å‡πá‡πÑ‡∏î‡πâ

4. Event Type : Message && Message Type : Text


<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nxtnoATyzz3ijF-S.png"> 
</p>

```javascript
// Message Type Text
// https://developers.line.biz/en/reference/messaging-api/#wh-text
if (event.type === "message" && event.message.type === "text") {
    // do somthing
    return res.end();

}
```

‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡∏∞‡∏£‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢‡∏Å‡πá‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Event ‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ text message ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ

5. Event Type : Postback

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Dz-7xZ72EIrJbG3TuRK4Q.png"> 
</p>

```javascript
// https://developers.line.biz/en/reference/messaging-api/#postback-event
if (event.type === "postback") {
    // do somthing
    return res.end();

}
```

‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡∏û‡∏£‡∏∞‡πÄ‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∑‡∏≠ postback ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ key value ‡∏ï‡πà‡∏≤‡∏á‡πÜ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡πà‡∏≤‡∏¢‡∏¥‡πâ‡∏á‡∏â‡∏∏‡∏ö ‡πÅ‡∏•‡∏∞ ‡∏à‡∏ö‡πÄ‡∏Å‡∏° ‡∏ô‡∏±‡πà‡∏ô‡πÄ‡∏≠‡∏á

‡πÄ‡∏≠‡∏≤‡∏•‡∏∞‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ Event ‡∏Ç‡∏≠‡∏á LINE ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏•‡∏∞ ‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á..‡πÄ‡∏•‡πà‡∏ô..‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏Å‡∏±‡∏ô



## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3 ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° -> ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° -> ‡∏à‡∏ö‡πÄ‡∏Å‡∏°

‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°
‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏±‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£ Config Message Event Type Text ‡∏ï‡πà‡∏≤‡∏á‡πÜ

File : src/webhook.js

```javascript
if (event.type === "message" && event.message.type === "text") {
    const lineProfile = await line.getProfile(userId)

    let textMessage = event.message.text
    if (textMessage === "‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤") {
        await line.reply(event.replyToken, [messages.ruleMessage()])
    } else if (textMessage === "‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°") {
        await line.reply(event.replyToken, [messages.textMessageQuickReply(`‡∏Ñ‡∏∏‡∏ì ${lineProfile.data.displayName}‡πÑ‡∏î‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß `)])
    } else if (textMessage === "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°") {
        await line.reply(event.replyToken, [messages.textMessageQuickReplyGame("‡∏ß‡∏£‡∏¢‡∏∏‡∏ó‡∏ò‡πÉ‡∏ï‡πâ‡∏´‡∏•‡πâ‡∏≤‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÅ‡∏û‡πâ‡∏ä‡∏ô‡∏∞‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß  \n ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡∏° ‡∏Å‡∏î '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°' \n\n ‡∏´‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡πÑ‡∏î‡πâ")])
    } else if (textMessage === "‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì") {
        // Function Clear Game all Status
        await firebase.deleteGameUserId(groupId, userId)
        await line.reply(event.replyToken, [messages.textMessageQuickReplyGame(`‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏•‡∏ö‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á ${lineProfile.data.displayName} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`)])
    } else if (textMessage === "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°") {

        // If Game Running 
        // Check Duplicate for Create Game 
        const count = await firebase.getCountGameGroupStatus(groupId, false)
        if (count === 0) {
            const resultId = await firebase.createGame(userId, groupId)
            await line.reply(event.replyToken, [messages.selectMessage(userId, groupId, resultId)])
        } else {
            await line.reply(event.replyToken, [messages.textMessage("‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ")])
        }
    }
    return res.end();

}

```

‡∏à‡∏≤‡∏Å Code ‡∏ä‡∏∏‡∏î‡∏ö‡∏ô‡∏ô‡∏µ‡πâ‡∏ú‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤ /messages/messages.js ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡πâ‡∏ô JSON ‡∏Ç‡∏≠‡∏á Quick Reply ‡πÅ‡∏•‡∏∞ Flex Message

1. ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≤
‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏è‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° ‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏ú‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏Å‡∏•‡∏≤‡∏á‡πÜ


<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Voo1uBPIebzYr6HyenBGiA.png"> 
</p>


2. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°

‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ú‡∏°‡πÅ‡∏Ñ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô interactive ‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏â‡∏¢‡πÜ ‡∏ß‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞ ‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß

3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°

‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡πÄ‡∏Å‡∏° Confirm ‡∏ß‡πà‡∏≤ ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏ã‡∏∂‡πà‡∏á‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ß‡πà‡∏≤ ‡∏ú‡∏°‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô : textMessageQuickReplyGame ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î Action ‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡πà‡∏≤ ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° ‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ô‡∏µ‡πâ

File : message/message.js

```javascript
const quickReplyGame = {
    "items": [{
            "type": "action",
            "imageUrl": "https://bucket.ex10.tech/images/8d325cbc-d31f-11ee-97d4-0242ac12000b/originalContentUrl.png",
            "action": {
                "type": "message",
                "label": "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°",
                "text": "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°"
            }
        },
        {
            "type": "action",
            "imageUrl": "https://bucket.ex10.tech/images/871f88ff-d3b0-11ee-97d4-0242ac12000b/originalContentUrl.png",
            "action": {
                "type": "message",
                "label": "‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì",
                "text": "‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"
            }
        }
    ]
}
```

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F3fpaeBm0rPCd-fIICL2ow.png"> 
</p>


4. ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ Query Database ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô deleteGameUserId

```javascript
await firebase.deleteGameUserId(groupId, userId)
```

File : util/firebase.js

```javascript
exports.deleteGameUserId = async (groupId, userId) => {

  let gameDocument = gameDb.where("groupId", "==", groupId).where('ownerId', '==', userId)
  await gameDocument.get().then(function (querySnapshot) {
    querySnapshot.forEach(function (doc) {
      doc.ref.delete();
    });
  });

}
```

‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÉ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏Å‡πá ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° ‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÄ‡∏£‡∏≤‡∏Ñ‡πà‡∏≠‡∏¢ Reply ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ö‡∏≠‡∏Å‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤ ‡πÄ‡∏£‡∏≤‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß

```javascript
await line.reply(event.replyToken, [messages.textMessageQuickReplyGame(`‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏•‡∏ö‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á ${lineProfile.data.displayName} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`)])
```

‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß ‡πÄ‡∏≠‡∏≤‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ç‡∏≠‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢

5. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDN-KhJnge4annEl50OHkQ.png"> 
</p>

```javascript
// If Game Running 
// Check Duplicate for Create Game 
const count = await firebase.getCountGameGroupStatus(groupId, false)
if (count === 0) {
    const resultId = await firebase.createGame(userId, groupId)
    await line.reply(event.replyToken, [messages.selectMessage(userId, groupId, resultId)])
} else {
    await line.reply(event.replyToken, [messages.textMessage("‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ")])
}
```

‡πÉ‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ ‡∏°‡∏µ‡πÄ‡∏Å‡∏° ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
```javascript
const count = await firebase.getCountGameGroupStatus(groupId, false)
```

```javascript
exports.getCountGameGroupStatus = async (groupId, status) => {
  const gameDocument = gameDb.where("groupId", "==", groupId).where('endgame', '==', status)
  const gameCount = await gameDocument.count().get()
  return gameCount.data().count
}
```


‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡πá‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ Create Game ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô createGame

File : util/firebase.js

```javascript
exports.createGame = async (userId, groupId) => {

  const gameDocument = gameDb.where("groupId", "==", groupId).where("userId", "==", userId)
  const gameCount = await gameDocument.count().get()
  if (gameCount.data().count === 0) {
    const result = await gameDb.add({
      ownerId: userId, // userID ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°
      groupId: groupId, // line group id
      ownerSelect: false, // defualt ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô false ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Ñ‡πâ‡∏≠‡∏ô ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©
      endgame: false, // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏ö‡πÄ‡∏Å‡∏°
      users: [], // user ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
      createAt: Date.now() // ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°
    })
    return result.id // game id
  }
  return false

}
```

‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÉ‡∏´‡πâ Chatbot Reply Flex Message ‡πÄ‡∏Å‡∏°‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dG6eCSlxLxyQYlnDuO6ETg.png"> 
</p>


‡πÇ‡∏î‡∏¢ Action ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏°‡∏à‡∏∞‡πÉ‡∏ä‡πâ Type Postback ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ
```json
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á action ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£
{
  "type": "postback",
  "label": "‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£",
  "data": `{"userId": "${userId}", "item": "scissors", "gameId": "${gameId}" , "groupId": "${groupId}"}`
}
```
‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏ú‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡∏±‡∏î JSON value ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ô‡πÉ‡∏ô property data ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö

‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏õ‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ
```json
{
      "type": "postback",
      "label": "‡∏à‡∏ö‡πÄ‡∏Å‡∏°",
      "displayText": "‡∏à‡∏ö‡πÄ‡∏Å‡∏°",
      "data": `{"userId":"${userId}", "item": "endgame","gameId":"${gameId}"}`
  },
```
‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô endgame ‡∏Ñ‡∏£‡∏±‡∏ö

‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÉ‡∏´‡πâ Chatbot ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Reply ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ß‡πà‡∏≤ ‚Äú‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ‚Äù ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏Å‡πà‡∏≠‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏ö‡πÄ‡∏Å‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

6. ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ‡πÅ‡∏•‡∏∞ ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏° ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© , ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£, ‡∏Ñ‡πâ‡∏≠‡∏ô ‡πÉ‡∏´‡πâ Chatbot ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏≠‡∏Å‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£)

<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyihHlR_3e90l7LkIlIIiA.png"> 
</p>
‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Code ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ Postback Data

```javascript
  // https://developers.line.biz/en/reference/messaging-api/#postback-event
  if (event.type === "postback") {

      // Data parse of Postback event
      const DPB = JSON.parse(event.postback.data)

      // Owner and Member Select
      if (DPB.item === "rock" || DPB.item === "paper" || DPB.item === "scissors") {

          await gameAction(DPB, groupId, userId, event.replyToken)
          return res.end();

      }
      ...

      return res.end();

  }
```

‡∏ã‡∏∂‡πà‡∏á‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô gameAction ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ Logic ‡∏ï‡πà‡∏≤‡∏á‡πÜ

File : src/webhook.js

```javascript
// DPB = data pare of postback event 
async function gameAction(DPB, groupId, userId, replyToken) {

    // Check Status for Game is Running
    const checkGameStatus = await firebase.getCheckGameGroupStatus(groupId, DPB.gameId)
    if (checkGameStatus) {

        // Validate isOwner
        const isOwnerSelected = await firebase.updateInsertOwnerSelect(groupId, DPB.gameId, DPB.item, userId)
        if (isOwnerSelected) {
            let msgOwnerSelected = "‡∏ñ‡∏∂‡∏á‡πÅ‡∏°‡πâ‡πÄ‡∏õ‡πá‡∏ô ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á ‡∏Å‡πá‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ!"
            if (isOwnerSelected === "done") {
                // Can't Change 
                msgOwnerSelected = "‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏£‡∏µ‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏ß‡∏ô!"
            }
            await line.reply(replyToken, [messages.textMessage(msgOwnerSelected)])
        } else {
            // Validate isMember
            const isMemberSelected = await firebase.updateInsertJoinerSelect(groupId, DPB.gameId, DPB.item, userId)
            const lineProfile = await line.getProfileGroup(groupId, userId)

            let msgMemberSelect = `‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ${lineProfile.data.displayName} ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!`
            if (!isMemberSelected) {
                // Can't Change 
                msgMemberSelect = `‡∏Ñ‡∏∏‡∏ì ${lineProfile.data.displayName} ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏à‡πÑ‡∏î‡πâ`
            }
            await line.reply(replyToken, [messages.textMessage(msgMemberSelect)])
        }
    }
}
```
- Step 1 ‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤ ‡∏°‡∏µ‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡πÜ
const checkGameStatus = await firebase.getCheckGameGroupStatus(groupId, DPB.gameId)
- Step 2 ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏Ñ‡πâ‡∏≠‡∏ô ‡∏Å‡∏£‡∏£‡πÑ‡∏Å‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ Insert Data ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏°
const isOwnerSelected = await firebase.updateInsertOwnerSelect(groupId, DPB.gameId, DPB.item, userId)
‡∏ã‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateInsertOwnerSelect ‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÅ‡∏•‡∏∞ ‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ

File : util/firebase.js
```javascript
exports.updateInsertOwnerSelect = async (groupId, gameId, item, userId) => {
try {
  const querySnapshot = await gameDb
    .where('groupId', '==', groupId)
    .where('endgame', '==', false)
    .get();
  for (const doc of querySnapshot.docs) {
    if (userId === doc.data().ownerId) {
      if (doc.id === gameId && !doc.data().ownerSelect) {
        await gameDb.doc(doc.id).update({
          ownerSelect: item,
        });
        return "done";
      } else {
        return "selected";
      }
    } else {
      return false;
    }

  }
} catch (error) {
  return false;
}
```

‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏ß‡πà‡∏≤ response ‡πÄ‡∏õ‡πá‡∏ô done ‡∏à‡∏∞ reply ‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß response ‡πÄ‡∏õ‡πá‡∏ô selected ‡∏Å‡πá‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏î‡πâ

```javascript
  if (isOwnerSelected) {
    let msgOwnerSelected = "‡∏ñ‡∏∂‡∏á‡πÅ‡∏°‡πâ‡πÄ‡∏õ‡πá‡∏ô ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á ‡∏Å‡πá‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ!"
    if (isOwnerSelected === "done") {
        // Can't Change 
        msgOwnerSelected = "‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏£‡∏µ‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πà‡∏ß‡∏ô!"
    }
    await line.reply(replyToken, [messages.textMessage(msgOwnerSelected)])
}
```

‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateInsertOwnerSelect ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô false ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡∏ú‡∏°‡∏à‡∏∞‡∏ï‡∏µ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á

const isMemberSelected = await firebase.updateInsertJoinerSelect(groupId, DPB.gameId, DPB.item, userId)
‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏∏‡πà‡∏ô‡∏ß‡∏≤‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô updateInsertJoinerSelect ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Update ‡πÉ‡∏ô Database ‡∏ã‡∏∂‡πà‡∏á‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ

File : util/firebase.js

```javascript
exports.updateInsertJoinerSelect = async (groupId, gameId, item, userId) => {
  try {
    const querySnapshot = await gameDb
      .where('groupId', '==', groupId)
      .where('endgame', '==', false)
      .get();
    for (const doc of querySnapshot.docs) {

      if (doc.id === gameId && doc.data().ownerId !== userId) {
        let userlistItem = doc.data().users
        const dataLength = Object.keys(userlistItem).length;

        let arrayData = userlistItem
        if (dataLength > 0) {
          let memberList = []
          for (const [index, userObject] of userlistItem.entries()) {
            let memberId = Object.keys(userObject)[0];
            memberList.push(memberId)
          }
          const hasValue = memberList.some(e => e === userId);
          if (!hasValue) {
            const newData = {
              [userId]: item,
            };
            arrayData.push(newData)
            await gameDb.doc(doc.id).update({
              users: arrayData,
            });
            return true;
          } else {
            return false;
          }

        } else {

          const newData = {
            [userId]: item,
          };
          arrayData.push(newData)
          await gameDb.doc(doc.id).update({
            users: arrayData,
          });

          return true;
        }

      }

      return false;
    }
  } catch (error) {
    return false;
  }
};
```
‡∏Ç‡∏±‡πâ‡∏ô‡πÅ‡∏£‡∏Å ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏ß‡πà‡∏≤ Property users ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô [] ‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏° ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏Å‡πá ‡∏õ‡∏±‡πâ‡∏ô Object userid[item]‡πÑ‡∏õ‡∏ï‡∏£‡∏á‡πÜ
‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡∏ß‡πà‡∏≤‡∏°‡∏µ user ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ userId ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô users[]
‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏à‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô firestore ‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ô‡∏µ‡πâ
<p align="center" width="100%">
    <img src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*uQ-SNXHAjXFKWRmo77xNSA.png
    "> 
</p>
‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡∏ã‡∏∂‡πà‡∏á ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ Event Member Join ‡∏à‡∏∞‡∏û‡∏ö‡∏ß‡πà‡∏≤ ‡∏ú‡∏°‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡πà‡∏≤‡∏ó‡∏≤‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏Å‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤

- ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô Flex Message ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
- ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏•‡πà‡∏ô

7. ‡∏à‡∏ö‡πÄ‡∏Å‡∏° (‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)

‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏ï‡∏±‡∏ß postback ‡∏Å‡πá‡∏°‡∏µ value endgame ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡∏à‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô endGame

```javascript
 // End Game 
if (DPB.item === "endgame") {

    await endGame(DPB, groupId, userId, event.replyToken)
    return res.end();

}
‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô endGame

async function endGame(DPB, groupId, userId, replyToken) {

    // Update Status  "endgame": true              
    const result = await firebase.endGame(groupId, userId)

    if (result) {

        // Get Member List by Group ID and Game ID
        const dataItem = await firebase.getUserByGame(groupId, DPB.gameId, userId);

        let userWin = [];
        let userEqual = [];
        let userLost = [];

        const ownerLineProfile = await line.getProfileGroup(groupId, userId);

        // Exception Error Game Fail
        if (!dataItem.ownerSelect || dataItem.users.length === 0) {
            await line.reply(replyToken, [messages.textMessageQuickReplyGame("‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")]);
        } else {

            for (const userObject of dataItem.users) {
                const memberId = Object.keys(userObject)[0];

                const lineProfile = await line.getProfileGroup(groupId, memberId);

                const userSelection = userObject[memberId];
                const ownerSelection = dataItem.ownerSelect;

                // Is Equl 
                if (userSelection === ownerSelection) {
                    userEqual.push(lineProfile.data);

                } else {
                    const userWinsAgainst = {
                        'rock': 'scissors',
                        'paper': 'rock',
                        'scissors': 'paper'
                    };

                    // Is Winer
                    if (userWinsAgainst[userSelection] === ownerSelection) {
                        userWin.push(lineProfile.data);

                    } else {
                        // Is Losser
                        userLost.push(lineProfile.data);
                    }
                }
            }


            let memberNo = 1;
            let nameList = '‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á ' + ownerLineProfile.data.displayName + ' ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ' + dataItem.ownerSelect;
            const appendUsers = (list, label, emoji) => {
                if (list.length > 0) {
                    nameList += `\n-----${label}-----`;
                    list.forEach((memberList) => {
                        nameList += `\n ${memberNo}.${memberList.displayName} ${emoji}`;
                        memberNo++;
                    });
                }
            };

            appendUsers(userWin, "‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà", "‚úÖ");
            appendUsers(userEqual, "‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏°‡∏≠‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà", "üòâ");
            appendUsers(userLost, "‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà", "‚ùå");

            nameList += "\n------ \n‡πÅ‡∏û‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡∏∞ ‡∏Ñ‡∏ô‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ò‡∏≠‡∏ô‡∏∞";

            await line.reply(replyToken, [messages.textMessageEndGame(nameList)]);
        }


    } else {
        await line.reply(replyToken, [messages.textMessage("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏Å‡∏°‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏à‡∏à‡∏ö‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß")])
    }
}
```
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏ú‡∏°‡∏à‡∏∞‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ update Status ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡πâ‡∏à‡∏ö‡πÄ‡∏Å‡∏°
```javascript
// update status endgame : true
const result = await firebase.endGame(groupId, userId)
```

‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏ú‡∏°‡∏Å‡πá‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏≠‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô

```javascript
const dataItem = await firebase.getUserByGame(groupId, DPB.gameId, userId);
```

‡πÅ‡∏≠‡∏ö‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤ owner ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏à‡∏ö‡πÄ‡∏Å‡∏° ‡∏Å‡πá‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡πà‡∏≤ ‡πÄ‡∏Å‡∏°‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
```javascript
// Error Game Fail
if (!dataItem.ownerSelect || dataItem.users.length === 0) {
    await line.reply(replyToken, [messages.textMessageQuickReplyGame("‡πÄ‡∏Å‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")]);
}
```
‡∏à‡∏∏‡∏î‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
```javascript
let userWin = [];
let userEqual = [];
let userLost = [];
for (const userObject of dataItem.users) {
      const memberId = Object.keys(userObject)[0];

      const lineProfile = await line.getProfileGroup(groupId, memberId);

      const userSelection = userObject[memberId];
      const ownerSelection = dataItem.ownerSelect;

      // Is Equl 
      if (userSelection === ownerSelection) {
          userEqual.push(lineProfile.data);

      } else {
          const userWinsAgainst = {
              'rock': 'scissors',
              'paper': 'rock',
              'scissors': 'paper'
          };

          // Is Winer
          if (userWinsAgainst[userSelection] === ownerSelection) {
              userWin.push(lineProfile.data);

          } else {
              // Is Losser
              userLost.push(lineProfile.data);
          }
      }
}
```
‡πÄ‡∏≠‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏≤‡∏´‡∏≤‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÅ‡∏û‡πâ‡∏ä‡∏ô‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏ß‡πà‡∏≤

- ‡∏ñ‡πâ‡∏≤ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡∏Å‡πá ‡πÄ‡∏™‡∏°‡∏≠ ‡πÅ‡∏•‡∏∞ push ‡πÄ‡∏Ç‡πâ‡∏≤ userEqual
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ç‡∏≠‡∏á userWinsAgainst ‡∏Å‡πá ‡∏ä‡∏ô‡∏∞‡πÑ‡∏õ ‡πÅ‡∏•‡∏∞ push ‡πÄ‡∏Ç‡πâ‡∏≤ userWin
- ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà ‡∏Å‡πá‡∏ô‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏û‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡∏∞ push ‡πÄ‡∏Ç‡πâ‡∏≤ userLost
‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ ‡∏Å‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ ‡∏ä‡∏ô‡∏∞ ‡πÄ‡∏™‡∏°‡∏≠‡πÅ‡∏•‡πâ‡∏ß

‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
```javascript
  let memberNo = 1;
  let nameList = '‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á ' + ownerLineProfile.data.displayName + ' ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ' + dataItem.ownerSelect;
  const appendUsers = (list, label, emoji) => {
      if (list.length > 0) {
          nameList += `\n-----${label}-----`;
          list.forEach((memberList) => {
              nameList += `\n ${memberNo}.${memberList.displayName} ${emoji}`;
              memberNo++;
          });
      }
  };

  appendUsers(userWin, "‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà", "‚úÖ");
  appendUsers(userEqual, "‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏°‡∏≠‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà", "üòâ");
  appendUsers(userLoss, "‡∏ú‡∏π‡πâ‡πÅ‡∏û‡πâ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà", "‚ùå");

  nameList += "\n------ \n‡πÅ‡∏û‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏£‡∏∞ ‡∏Ñ‡∏ô‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏ò‡∏≠‡∏ô‡∏∞";

  await line.reply(replyToken, [messages.textMessageEndGame(nameList)]);
```
‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏Ñ‡∏£‡∏≤‡∏ß‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á LINE Group ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏Å‡πá‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡πâ ‡∏ä‡∏ô‡∏∞ ‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ ‡∏ó‡∏≥‡πÇ‡∏ó‡∏©‡∏Å‡∏±‡∏ô‡∏™‡∏ô‡∏∏‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢




